{% extends 'books/base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<h1 class="page-title">{{ book.title }}</h1>

<div class="actions">
    <a href="{% url 'books:book_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    <a href="{% url 'books:book_update' book.pk %}" class="btn btn-success">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
    <a href="{% url 'books:book_delete' book.pk %}" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
    <a href="{% url 'books:review_create' %}?book={{ book.pk }}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
</div>

<div class="detail-section">
    <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
    
    <div class="detail-field">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
        <p>{{ book.title }}</p>
    </div>
    
    <div class="detail-field">
        <label>–ê–≤—Ç–æ—Ä:</label>
        <p>{{ book.author }}</p>
    </div>
    
    <div class="detail-field">
        <label>–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ:</label>
        <p><a href="{% url 'books:publisher_detail' book.publisher.pk %}">{{ book.publisher.name }}</a> ({{ book.publisher.country }})</p>
    </div>
    
    <div class="detail-field">
        <label>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</label>
        <p>{{ book.published_date|date:"d.m.Y" }}</p>
    </div>
    
    <div class="detail-field">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
        <p>{{ book.description|linebreaks }}</p>
    </div>
</div>

<div class="detail-section">
    <h2>–ú–∞–≥–∞–∑–∏–Ω—ã</h2>
    {% if book.stores.all %}
        <ul>
            {% for store in book.stores.all %}
                <li><a href="{% url 'books:store_detail' store.pk %}">{{ store.name }}</a> ({{ store.city }})</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>–ö–Ω–∏–≥–∞ –Ω–µ –ø—Ä–æ–¥–∞–µ—Ç—Å—è –Ω–∏ –≤ –æ–¥–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–µ.</p>
    {% endif %}
</div>

<div class="detail-section">
    <h2>–û—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥</h2>
    
    {% if reviews_count > 0 %}
        <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤:</strong> {{ reviews_count }}</p>
        {% if avg_rating %}
            <p><strong>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞:</strong> 
                <span class="rating">
                    {% with avg_int=avg_rating|floatformat:0 %}
                        {% for i in "12345" %}
                            {% if forloop.counter <= avg_int|add:"0" %}
                                ‚òÖ
                            {% else %}
                                <span class="rating-empty">‚òÜ</span>
                            {% endif %}
                        {% endfor %}
                    {% endwith %}
                </span>
                {{ avg_rating|floatformat:2 }} / 5.00
            </p>
        {% endif %}
        
        <div style="margin-top: 1.5rem;">
            <h3>–°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤:</h3>
            {% for review in book.reviews.all %}
                <div class="card" style="margin-top: 1rem;">
                    <div class="card-header">
                        –û—Ü–µ–Ω–∫–∞: 
                        <span class="rating">
                            {% for i in "12345" %}
                                {% if forloop.counter <= review.rating %}
                                    ‚òÖ
                                {% else %}
                                    <span class="rating-empty">‚òÜ</span>
                                {% endif %}
                            {% endfor %}
                        </span>
                        {{ review.rating }}/5
                    </div>
                    <div class="card-body">
                        <p>{{ review.text|linebreaks }}</p>
                    </div>
                    <div class="card-footer">
                        <small>–î–∞—Ç–∞: {{ review.created_at|date:"d.m.Y H:i" }}</small>
                        <div class="actions" style="margin-top: 0.5rem;">
                            <a href="{% url 'books:review_detail' review.pk %}" class="btn btn-primary btn-sm">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                            <a href="{% url 'books:review_update' review.pk %}" class="btn btn-success btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                            <a href="{% url 'books:review_delete' review.pk %}" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
            
            {% if book.reviews.count > 10 %}
                <p style="margin-top: 1rem;">
                    <a href="{% url 'books:review_list' %}?book={{ book.pk }}">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ—Ç–∑—ã–≤—ã ({{ book.reviews.count }})</a>
                </p>
            {% endif %}
        </div>
    {% else %}
        <p>–ù–∞ —ç—Ç—É –∫–Ω–∏–≥—É –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. <a href="{% url 'books:review_create' %}?book={{ book.pk }}">–û—Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –æ—Ç–∑—ã–≤</a></p>
    {% endif %}
</div>
{% endblock %}

