{% extends 'books/base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<h1 class="page-title">{{ page_title }}</h1>

<div class="actions">
    <a href="{% url 'books:review_create' %}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filters">
    <form method="get">
        <div class="filter-group">
            <label>–û—Ü–µ–Ω–∫–∞:</label>
            <select name="rating" class="form-control" onchange="this.form.submit()">
                <option value="">–í—Å–µ –æ—Ü–µ–Ω–∫–∏</option>
                {% for i in "12345" %}
                    <option value="{{ forloop.counter }}" {% if current_rating == forloop.counter|stringformat:"s" %}selected{% endif %}>
                        {{ forloop.counter }} –∑–≤–µ–∑–¥
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label>–ö–Ω–∏–≥–∞:</label>
            <select name="book" class="form-control" onchange="this.form.submit()">
                <option value="">–í—Å–µ –∫–Ω–∏–≥–∏</option>
                {% for book in books %}
                    <option value="{{ book.id }}" {% if current_book == book.id|stringformat:"s" %}selected{% endif %}>
                        {{ book.title }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        {% if current_rating or current_book %}
            <a href="{% url 'books:review_list' %}" class="btn btn-secondary" style="margin-top: 1.5rem;">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
        {% endif %}
    </form>
</div>

<!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ -->
{% if reviews %}
    <p style="margin-bottom: 1rem; color: #6c757d;">
        –ù–∞–π–¥–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: {{ reviews.paginator.count }}
    </p>
    
    <div class="list-group">
        {% for review in reviews %}
            <div class="list-group-item">
                <div>
                    <h3 style="margin-bottom: 0.5rem;">
                        <a href="{% url 'books:review_detail' review.pk %}">–û—Ç–∑—ã–≤ –Ω–∞ "{{ review.book.title }}"</a>
                    </h3>
                    <p style="color: #6c757d; margin-bottom: 0.25rem;">
                        <strong>–ö–Ω–∏–≥–∞:</strong> <a href="{% url 'books:book_detail' review.book.pk %}">{{ review.book.title }}</a> - {{ review.book.author }}
                    </p>
                    <p style="color: #6c757d; margin-bottom: 0.25rem;">
                        <strong>–û—Ü–µ–Ω–∫–∞:</strong> 
                        <span class="rating">
                            {% for i in "12345" %}
                                {% if forloop.counter <= review.rating %}
                                    ‚òÖ
                                {% else %}
                                    <span class="rating-empty">‚òÜ</span>
                                {% endif %}
                            {% endfor %}
                        </span>
                        {{ review.rating }}/5
                    </p>
                    <p style="color: #6c757d; margin-bottom: 0.25rem;">
                        <strong>–î–∞—Ç–∞:</strong> {{ review.created_at|date:"d.m.Y H:i" }}
                    </p>
                    <p style="margin-top: 0.5rem;">
                        {{ review.text|truncatewords:30 }}
                    </p>
                </div>
                <div class="actions">
                    <a href="{% url 'books:review_detail' review.pk %}" class="btn btn-primary btn-sm">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                    <a href="{% url 'books:review_update' review.pk %}" class="btn btn-success btn-sm">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <a href="{% url 'books:review_delete' review.pk %}" class="btn btn-danger btn-sm">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                </div>
            </div>
        {% endfor %}
    </div>
    
    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if reviews.has_other_pages %}
        <div class="pagination">
            {% if reviews.has_previous %}
                <a href="?page=1{% if current_rating %}&rating={{ current_rating }}{% endif %}{% if current_book %}&book={{ current_book }}{% endif %}">¬´ –ü–µ—Ä–≤–∞—è</a>
                <a href="?page={{ reviews.previous_page_number }}{% if current_rating %}&rating={{ current_rating }}{% endif %}{% if current_book %}&book={{ current_book }}{% endif %}">‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            {% endif %}
            
            <span class="current">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ reviews.number }} –∏–∑ {{ reviews.paginator.num_pages }}
            </span>
            
            {% if reviews.has_next %}
                <a href="?page={{ reviews.next_page_number }}{% if current_rating %}&rating={{ current_rating }}{% endif %}{% if current_book %}&book={{ current_book }}{% endif %}">–°–ª–µ–¥—É—é—â–∞—è ‚Ä∫</a>
                <a href="?page={{ reviews.paginator.num_pages }}{% if current_rating %}&rating={{ current_rating }}{% endif %}{% if current_book %}&book={{ current_book }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
            {% endif %}
        </div>
    {% endif %}
{% else %}
    <div class="card">
        <p>–û—Ç–∑—ã–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. <a href="{% url 'books:review_create' %}">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –æ—Ç–∑—ã–≤</a></p>
    </div>
{% endif %}
{% endblock %}

