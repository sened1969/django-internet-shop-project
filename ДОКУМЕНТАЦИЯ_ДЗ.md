# Документация проекта: Многофункциональная форма с использованием Django

## Описание проекта

Это веб-приложение на Django, которое включает функциональность регистрации, авторизации и отправки сообщений. Проект демонстрирует работу с формами, шаблонами, валидацией данных и Ajax-запросами.

## Установка и запуск

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Применение миграций базы данных

```bash
python manage.py makemigrations
python manage.py migrate
```

### 3. Создание суперпользователя (опционально)

```bash
python manage.py createsuperuser
```

Это необходимо для доступа к административной панели Django.

### 4. Запуск сервера разработки

```bash
python manage.py runserver
```

### 5. Открытие в браузере

- **Главная страница (каталог товаров)**: http://127.0.0.1:8000/
- **Регистрация**: http://127.0.0.1:8000/register/
- **Авторизация**: http://127.0.0.1:8000/login/
- **Связаться с нами**: http://127.0.0.1:8000/contact/
- **Профиль пользователя**: http://127.0.0.1:8000/profile/ (требуется авторизация)
- **Админ-панель**: http://127.0.0.1:8000/admin/

## Основные функции

### 1. Регистрация пользователя (`/register/`)

- **Форма регистрации** включает поля:
  - Имя пользователя (username)
  - Электронная почта (email)
  - Пароль (password1)
  - Подтверждение пароля (password2)

- **Валидация**:
  - Проверка уникальности email
  - Проверка совпадения паролей
  - Минимальная длина пароля: 8 символов

- **После успешной регистрации**: пользователь перенаправляется на страницу успешной регистрации (`/registration-success/`)

### 2. Авторизация пользователя (`/login/`)

- **Форма авторизации** включает поля:
  - Имя пользователя (username)
  - Пароль (password)

- **После успешной авторизации**: пользователь перенаправляется на главную страницу (`/home/`)

### 3. Отправка сообщения (`/contact/`)

- **Форма отправки сообщения** включает поля:
  - Имя отправителя (name)
  - Электронная почта (email)
  - Текст сообщения (message, максимум 500 символов)

- **Валидация**:
  - Проверка, что сообщение не пустое
  - Максимальная длина сообщения: 500 символов

- **Ajax-обработка**: форма отправляется без перезагрузки страницы с использованием Ajax

- **После успешной отправки**: отображается сообщение об успехе, форма очищается

### 4. Профиль пользователя (`/profile/`)

- **Требуется авторизация**
- Отображает:
  - Информацию о пользователе (имя пользователя, email, дата регистрации, последний вход)
  - Список всех отправленных пользователем сообщений

### 5. Главная страница (`/home/`)

- **Требуется авторизация**
- Приветственная страница для авторизованных пользователей
- Содержит ссылки на основные разделы сайта

## Структура проекта

```
myshop/
├── myshop/              # Основная директория проекта Django
│   ├── settings.py      # Настройки проекта
│   ├── urls.py         # Главный файл URL-маршрутов
│   └── ...
├── shop/               # Приложение интернет-магазина
│   ├── models.py       # Модели Product и Message
│   ├── forms.py        # Формы RegistrationForm, LoginForm, ContactForm
│   ├── views.py        # Представления для всех страниц
│   ├── urls.py         # URL-маршруты приложения
│   ├── admin.py        # Настройка админ-панели
│   └── migrations/     # Миграции базы данных
├── templates/          # Шаблоны
│   └── shop/
│       ├── base.html              # Базовый шаблон
│       ├── register.html          # Форма регистрации
│       ├── login.html             # Форма авторизации
│       ├── registration_success.html  # Страница успешной регистрации
│       ├── home.html              # Главная страница
│       ├── contact.html            # Форма отправки сообщения
│       ├── profile.html            # Профиль пользователя
│       ├── product_list.html       # Список товаров
│       └── product_detail.html     # Детальная страница товара
├── static/             # Статические файлы
│   └── shop/
│       └── css/
│           └── styles.css  # Стили для оформления
├── media/              # Медиа-файлы (загружаемые пользователями)
└── manage.py           # Управляющий скрипт Django
```

## Модели данных

### Product (Товар)
- `name` - название товара
- `description` - описание товара
- `price` - цена товара
- `image` - изображение товара (опционально)
- `created_at` - дата создания

### Message (Сообщение)
- `user` - связь с пользователем (опционально, если не авторизован)
- `name` - имя отправителя
- `email` - электронная почта отправителя
- `message` - текст сообщения (максимум 500 символов)
- `created_at` - дата создания

## Формы

### RegistrationForm
- Наследуется от `forms.ModelForm`
- Поля: username, email, password1, password2
- Кастомная валидация:
  - Проверка уникальности email
  - Проверка совпадения паролей
  - Минимальная длина пароля: 8 символов

### LoginForm
- Наследуется от `AuthenticationForm` Django
- Поля: username, password

### ContactForm
- Наследуется от `forms.ModelForm`
- Поля: name, email, message
- Кастомная валидация:
  - Проверка, что сообщение не пустое
  - Максимальная длина сообщения: 500 символов

## URL-маршруты

- `/` - список товаров (`product_list`)
- `/product/<id>/` - детальная информация о товаре (`product_detail`)
- `/register/` - регистрация (`register`)
- `/registration-success/` - страница успешной регистрации (`registration_success`)
- `/login/` - авторизация (`login_view`)
- `/logout/` - выход из системы (`logout_view`)
- `/home/` - главная страница для авторизованных пользователей (`home`)
- `/contact/` - форма отправки сообщения (`contact`)
- `/contact/ajax/` - Ajax-обработчик отправки сообщения (`contact_ajax`)
- `/profile/` - профиль пользователя (`profile`)

## Технологии

- **Django** - веб-фреймворк
- **Django Forms** - работа с формами
- **Django Authentication** - система аутентификации
- **Ajax/JavaScript** - асинхронная отправка форм
- **HTML/CSS** - верстка и стилизация

## Особенности реализации

### Валидация форм

1. **RegistrationForm**:
   - Метод `clean_email()` проверяет уникальность email
   - Метод `clean_password2()` проверяет совпадение паролей и минимальную длину

2. **ContactForm**:
   - Метод `clean_message()` проверяет, что сообщение не пустое и не превышает 500 символов

### Ajax-обработка

Форма отправки сообщения (`/contact/`) использует Ajax для отправки данных без перезагрузки страницы:
- Обработка выполняется в представлении `contact_ajax`
- Возвращает JSON-ответ с результатом валидации
- Отображает сообщения об успехе или ошибках на странице

### Защита от CSRF

Все формы защищены от CSRF-атак с помощью токена `{% csrf_token %}` в шаблонах.

### Наследование шаблонов

Все шаблоны наследуются от базового шаблона `base.html`, что обеспечивает единообразный дизайн и упрощает поддержку.

## Тестирование

### Тестирование регистрации

1. Перейдите на `/register/`
2. Заполните форму регистрации
3. Проверьте валидацию (попробуйте ввести несовпадающие пароли или существующий email)
4. После успешной регистрации вы будете перенаправлены на страницу успеха

### Тестирование авторизации

1. Перейдите на `/login/`
2. Введите учетные данные зарегистрированного пользователя
3. После успешной авторизации вы будете перенаправлены на `/home/`

### Тестирование отправки сообщения

1. Перейдите на `/contact/`
2. Заполните форму и отправьте сообщение
3. Проверьте, что сообщение отправляется без перезагрузки страницы (Ajax)
4. Проверьте валидацию (попробуйте отправить пустое сообщение или сообщение длиннее 500 символов)

### Тестирование профиля

1. Авторизуйтесь в системе
2. Перейдите на `/profile/`
3. Проверьте, что отображается информация о пользователе и список отправленных сообщений

## Дополнительные возможности

- Адаптивный дизайн для мобильных устройств
- Красивое оформление форм с использованием CSS
- Сообщения об успехе и ошибках через систему сообщений Django
- Интеграция с административной панелью Django для управления сообщениями

## Решение проблем

### Проблема: Статические файлы не загружаются

**Решение**: Убедитесь, что в `settings.py` правильно настроены `STATIC_URL` и `STATICFILES_DIRS`.

### Проблема: Ошибка CSRF при отправке формы через Ajax

**Решение**: Убедитесь, что CSRF-токен передается в заголовках запроса (реализовано в JavaScript коде формы).

### Проблема: Сообщения не сохраняются в базе данных

**Решение**: Убедитесь, что миграции применены (`python manage.py migrate`).

## Дальнейшее развитие

Возможные улучшения проекта:

1. Добавление email-уведомлений при отправке сообщений
2. Реализация восстановления пароля
3. Добавление возможности редактирования профиля
4. Реализация пагинации для списка сообщений в профиле
5. Добавление возможности удаления сообщений
6. Интеграция с системой товаров (связь сообщений с товарами)

