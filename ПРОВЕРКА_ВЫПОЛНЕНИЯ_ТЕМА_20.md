# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –î–ó "–¢–µ–º–∞ #20. –ó–∞–ø—Ä–æ—Å—ã –≤ Django ORM"

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

### 1.1. –°–æ–∑–¥–∞–Ω—ã —Ç—Ä–∏ –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏

#### ‚úÖ Publisher (–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ)
- **–ü–æ–ª—è:** `name` (CharField), `country` (CharField)
- **–°–≤—è–∑—å:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º —Å Book (ForeignKey –≤ Book)
- **–§–∞–π–ª:** `books/models.py`, —Å—Ç—Ä–æ–∫–∏ 10-40
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

#### ‚úÖ Store (–ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω)
- **–ü–æ–ª—è:** `name` (CharField), `city` (CharField)
- **–°–≤—è–∑—å:** –ú–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º —Å Book (ManyToManyField –≤ Book)
- **–§–∞–π–ª:** `books/models.py`, —Å—Ç—Ä–æ–∫–∏ 43-65
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

#### ‚úÖ Review (–û—Ç–∑—ã–≤—ã –Ω–∞ –∫–Ω–∏–≥–∏)
- **–ü–æ–ª—è:** `rating` (IntegerField, 1-5), `text` (TextField), `created_at` (DateTimeField)
- **–°–≤—è–∑—å:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º —Å Book (ForeignKey –Ω–∞ Book)
- **–§–∞–π–ª:** `books/models.py`, —Å—Ç—Ä–æ–∫–∏ 130-170
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 1.2. –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å Book

#### ‚úÖ Book (–ö–Ω–∏–≥–∞)
- **–ü–æ–ª—è:** `title`, `author`, `published_date`, `description`
- **–°–≤—è–∑—å —Å Publisher:** ForeignKey (publisher) - —Å—Ç—Ä–æ–∫–∏ 110-116
- **–°–≤—è–∑—å —Å Store:** ManyToManyField (stores) - —Å—Ç—Ä–æ–∫–∏ 118-123
- **–§–∞–π–ª:** `books/models.py`, —Å—Ç—Ä–æ–∫–∏ 85-128
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 1.3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏

#### ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
- **PublisherAdmin** - —Å—Ç—Ä–æ–∫–∏ 11-29
- **BookAdmin** - —Å—Ç—Ä–æ–∫–∏ 35-70
- **StoreAdmin** - —Å—Ç—Ä–æ–∫–∏ 73-88
- **ReviewAdmin** - —Å—Ç—Ä–æ–∫–∏ 91-115
- **–§–∞–π–ª:** `books/admin.py`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 2: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 2.1. ‚úÖ –ö–Ω–∏–≥–∏ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤ –∏–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã
- **–§—É–Ω–∫—Ü–∏—è:** `get_books_by_publisher_country(country)`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Book.objects.filter(publisher__country=country)`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 15-28
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 2.2. ‚úÖ –ö–Ω–∏–≥–∏, –ø—Ä–æ–¥–∞—é—â–∏–µ—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- **–§—É–Ω–∫—Ü–∏—è:** `get_books_by_store_city(city)`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Book.objects.filter(stores__city=city).distinct()`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 31-45
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 2.3. ‚úÖ –ö–Ω–∏–≥–∏ —Å–æ —Å—Ä–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–∫–æ–π –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞
- **–§—É–Ω–∫—Ü–∏—è:** `get_books_with_avg_rating_above(rating_threshold)`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Book.objects.annotate(avg_rating=Avg('reviews__rating')).filter(avg_rating__gt=rating_threshold)`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 48-66
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 2.4. ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥ –≤ –∫–∞–∂–¥–æ–º –º–∞–≥–∞–∑–∏–Ω–µ
- **–§—É–Ω–∫—Ü–∏—è:** `get_store_books_count()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Store.objects.annotate(books_count=Count('books')).order_by('-books_count')`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 69-81
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 2.5. ‚úÖ –ú–∞–≥–∞–∑–∏–Ω—ã —Å –∫–Ω–∏–≥–∞–º–∏ –ø–æ—Å–ª–µ –¥–∞—Ç—ã, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
- **–§—É–Ω–∫—Ü–∏—è:** `get_stores_with_books_after_date(date)`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Store.objects.filter(books__published_date__gt=date).annotate(books_count=Count('books')).distinct().order_by('-books_count')`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 84-105
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### 3.1. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ select_related() –¥–ª—è ForeignKey
- **–§—É–Ω–∫—Ü–∏—è:** `get_books_with_publisher_optimized()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Book.objects.select_related('publisher').all()`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 112-125
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 3.2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prefetch_related() –¥–ª—è ManyToMany
- **–§—É–Ω–∫—Ü–∏—è:** `get_books_with_stores_optimized()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Book.objects.prefetch_related('stores').all()`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 128-141
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 3.3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prefetch_related() –¥–ª—è –æ–±—Ä–∞—Ç–Ω—ã—Ö —Å–≤—è–∑–µ–π
- **–§—É–Ω–∫—Ü–∏—è:** `get_books_with_reviews_optimized()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `Book.objects.prefetch_related('reviews').all()`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 144-157
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 3.4. ‚úÖ –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **–§—É–Ω–∫—Ü–∏—è:** `get_books_fully_optimized()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è `select_related('publisher')` –∏ `prefetch_related('stores', 'reviews')`
- **–§–∞–π–ª:** `books/queries.py`, —Å—Ç—Ä–æ–∫–∏ 160-175
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

## ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### ‚úÖ –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- **–§–∞–π–ª:** `books/README.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –∏ —Å–≤—è–∑–µ–π
- **–§–∞–π–ª:** `books/models.py` - –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ docstrings
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### ‚úÖ –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–§–∞–π–ª:** `books/–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–°–û–ó–î–ê–ù–ò–Ø_–¢–ï–°–¢–û–í–´–•_–î–ê–ù–ù–´–•.md`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç:** `books/management/commands/create_test_data.py`
- **–ö–æ–º–∞–Ω–¥–∞:** `python manage.py create_test_data`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–§–∞–π–ª:** `books/queries.py` - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- **–§–∞–π–ª:** `books/README.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–§–∞–π–ª:** `–ü—Ä–æ—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è/–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø_–¢–ï–ú–ê_20.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### ‚úÖ –ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–§–∞–π–ª:** `books/queries.py` - —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- **–§–∞–π–ª:** `books/README.md` - —Ä–∞–∑–¥–µ–ª –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–§–∞–π–ª:** `–ü—Ä–æ—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è/–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø_–¢–ï–ú–ê_20.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

## ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- **–ü–∞–ø–∫–∞:** `–°–∫—Ä–∏–Ω—à–æ—Ç—ã/`
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤:** 37 —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 3 –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (Publisher, Store, Review)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å Book —Å —Å–≤—è–∑—è–º–∏
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- **–û—Ü–µ–Ω–∫–∞:** 100% ‚úÖ

### –ó–∞–¥–∞–Ω–∏–µ 2: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –í—Å–µ 5 –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ï—Å—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û—Ü–µ–Ω–∫–∞:** 100% ‚úÖ

### –ó–∞–¥–∞–Ω–∏–µ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ select_related() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ prefetch_related() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è ManyToMany
- ‚úÖ prefetch_related() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω—ã—Ö —Å–≤—è–∑–µ–π
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- **–û—Ü–µ–Ω–∫–∞:** 100% ‚úÖ

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ü–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- **–û—Ü–µ–Ω–∫–∞:** 100% ‚úÖ

---

## üéØ –û–±—â–∏–π –≤—ã–≤–æ–¥

**–í–°–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –î–û–ú–ê–®–ù–ï–ì–û –ó–ê–î–ê–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´ –ù–ê 100%**

‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã  
‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞  
‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã  
‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã  

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –°–î–ê–ß–ï

