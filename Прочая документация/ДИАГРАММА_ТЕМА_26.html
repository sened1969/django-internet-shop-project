<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–º–∞ #26. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ - –î–∏–∞–≥—Ä–∞–º–º—ã</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #16a085;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #16a085;
            padding-left: 10px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .description {
            background: #d5f4e6;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .mermaid {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>üõçÔ∏è –¢–µ–º–∞ #26. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ - –î–∏–∞–≥—Ä–∞–º–º—ã</h1>

    <div class="description">
        <p><strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</strong> –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—Ä–∑–∏–Ω–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class="diagram-container">
        <h2>1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h2>
        <div class="mermaid">
        graph TB
            A["–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å<br/>–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"] -->|"1. GET –∑–∞–ø—Ä–æ—Å"| B["URL: /product/add/"]
            B -->|"2. –ú–∞—Ä—à—Ä—É—Ç"| C["View: add_product"]
            C -->|"3. –ü—Ä–æ–≤–µ—Ä–∫–∞"| D{"login_required<br/>–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω?"}
            D -->|"–î–∞"| E["–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã<br/>ProductForm"]
            D -->|"–ù–µ—Ç"| F["–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login/"]
            
            E -->|"4. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã"| G["–®–∞–±–ª–æ–Ω:<br/>add_product.html"]
            G -->|"5. POST –∑–∞–ø—Ä–æ—Å"| C
            C -->|"6. –í–∞–ª–∏–¥–∞—Ü–∏—è"| H{"–§–æ—Ä–º–∞ –≤–∞–ª–∏–¥–Ω–∞?"}
            H -->|"–ù–µ—Ç"| E
            H -->|"–î–∞"| I["–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î<br/>Product.objects.create"]
            I -->|"7. –£—Å–ø–µ—Ö"| J["–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞<br/>/product/id/"]
            J -->|"8. –°–æ–æ–±—â–µ–Ω–∏–µ"| K["–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω"]
            
            style A fill:#3498db,stroke:#2980b9,color:#fff
            style C fill:#2ecc71,stroke:#27ae60,color:#fff
            style E fill:#9b59b6,stroke:#8e44ad,color:#fff
            style I fill:#e67e22,stroke:#d35400,color:#fff
            style F fill:#e74c3c,stroke:#c0392b,color:#fff
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É, –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 2: –ü–æ—Ç–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class="diagram-container">
        <h2>2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</h2>
        <div class="mermaid">
        sequenceDiagram
            participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å<br/>(–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
            participant Template as –®–∞–±–ª–æ–Ω<br/>product_list.html
            participant View as View<br/>add_product
            participant Form as ProductForm
            participant Model as Model<br/>Product
            participant DB as –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
            
            User->>Template: –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏<br/>"–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"
            Template->>View: GET /product/add/
            View->>View: –ü—Ä–æ–≤–µ—Ä–∫–∞ @login_required
            View->>Form: –°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Å—Ç–æ–π —Ñ–æ—Ä–º—ã
            Form-->>View: ProductForm()
            View->>Template: –†–µ–Ω–¥–µ—Ä add_product.html
            Template-->>User: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
            
            User->>Template: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
            Template->>View: POST /product/add/<br/>—Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞
            View->>Form: ProductForm(request.POST, request.FILES)
            Form->>Form: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
            alt –í–∞–ª–∏–¥–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
                Form-->>View: form.is_valid() = True
                View->>Model: form.save()
                Model->>DB: INSERT INTO shop_products
                DB-->>Model: –¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω
                Model-->>View: product –æ–±—ä–µ–∫—Ç
                View->>View: messages.success()
                View-->>User: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /product/id/
            else –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞
                Form-->>View: form.is_valid() = False
                View->>Template: –†–µ–Ω–¥–µ—Ä —Å –æ—à–∏–±–∫–∞–º–∏
                Template-->>User: –§–æ—Ä–º–∞ —Å –æ—à–∏–±–∫–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            end
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –î–µ—Ç–∞–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 3: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—Ä–∑–∏–Ω–µ -->
    <div class="diagram-container">
        <h2>3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—Ä–∑–∏–Ω–µ</h2>
        <div class="mermaid">
        graph TB
            A["–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"] -->|"–ó–∞–ø—Ä–æ—Å"| B{"–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω?<br/>user.is_authenticated"}
            
            B -->|"–î–∞"| C["–®–∞–±–ª–æ–Ω:<br/>product_detail.html"]
            C -->|"–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç"| D["–ö–Ω–æ–ø–∫–∞<br/>–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"]
            D -->|"POST –∑–∞–ø—Ä–æ—Å"| E["View: add_to_cart<br/>login_required"]
            E -->|"–ü—Ä–æ–≤–µ—Ä–∫–∞"| F{"–¢–æ–≤–∞—Ä –Ω–∞ —Å–∫–ª–∞–¥–µ?<br/>stock > 0"}
            F -->|"–î–∞"| G["–°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ<br/>CartItem"]
            G -->|"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ"| H["–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö<br/>Cart, CartItem"]
            H -->|"–£—Å–ø–µ—Ö"| I["–°–æ–æ–±—â–µ–Ω–∏–µ:<br/>–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É"]
            
            B -->|"–ù–µ—Ç"| J["–®–∞–±–ª–æ–Ω:<br/>product_detail.html"]
            J -->|"–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç"| K["–°–æ–æ–±—â–µ–Ω–∏–µ:<br/>–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è<br/>–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É"]
            K -->|"–ö–Ω–æ–ø–∫–∞"| L["–°—Å—ã–ª–∫–∞ –Ω–∞ /login/"]
            
            E -->|"–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"| M["–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login/<br/>?next=/cart/add/id/"]
            
            style A fill:#3498db,stroke:#2980b9,color:#fff
            style B fill:#f39c12,stroke:#e67e22,color:#fff
            style E fill:#2ecc71,stroke:#27ae60,color:#fff
            style G fill:#9b59b6,stroke:#8e44ad,color:#fff
            style K fill:#e74c3c,stroke:#c0392b,color:#fff
            style M fill:#e74c3c,stroke:#c0392b,color:#fff
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –õ–æ–≥–∏–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞: –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É, –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ - —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –≤–æ–π—Ç–∏.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 4: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã -->
    <div class="diagram-container">
        <h2>4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div class="mermaid">
        graph TB
            subgraph Forms["–§–æ—Ä–º—ã"]
                A["ProductForm<br/>shop/forms.py"]
            end
            
            subgraph Views["–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è"]
                B["add_product()<br/>shop/views.py<br/>@login_required"]
                C["add_to_cart()<br/>shop/views.py<br/>@login_required"]
            end
            
            subgraph Templates["–®–∞–±–ª–æ–Ω—ã"]
                D["add_product.html<br/>—Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è"]
                E["product_list.html<br/>–∫–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"]
                F["product_detail.html<br/>–∫–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"]
            end
            
            subgraph URLs["–ú–∞—Ä—à—Ä—É—Ç—ã"]
                G["/product/add/<br/>shop/urls.py"]
                H["/cart/add/id/<br/>shop/urls.py"]
            end
            
            subgraph Models["–ú–æ–¥–µ–ª–∏"]
                I["Product<br/>shop/models.py"]
                J["Cart<br/>shop/models.py"]
                K["CartItem<br/>shop/models.py"]
            end
            
            subgraph Auth["–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"]
                L["@login_required<br/>–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä"]
                M["user.is_authenticated<br/>–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —à–∞–±–ª–æ–Ω–µ"]
            end
            
            A --> B
            B --> D
            B --> I
            E --> G
            G --> B
            F --> H
            H --> C
            C --> J
            C --> K
            L --> B
            L --> C
            M --> E
            M --> F
            
            style A fill:#3498db,stroke:#2980b9,color:#fff
            style B fill:#2ecc71,stroke:#27ae60,color:#fff
            style C fill:#2ecc71,stroke:#27ae60,color:#fff
            style D fill:#9b59b6,stroke:#8e44ad,color:#fff
            style E fill:#9b59b6,stroke:#8e44ad,color:#fff
            style F fill:#9b59b6,stroke:#8e44ad,color:#fff
            style I fill:#e67e22,stroke:#d35400,color:#fff
            style L fill:#e74c3c,stroke:#c0392b,color:#fff
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: —Ñ–æ—Ä–º—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —à–∞–±–ª–æ–Ω—ã, –º–∞—Ä—à—Ä—É—Ç—ã –∏ –º–æ–¥–µ–ª–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
    <div class="diagram-container">
        <h2>5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤</h2>
        <div class="mermaid">
        graph LR
            A["–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"] -->|"1. –ü–µ—Ä–µ—Ö–æ–¥"| B["product_list.html"]
            B -->|"2. –ö–Ω–æ–ø–∫–∞"| C{"user.is_authenticated"}
            C -->|"–î–∞"| D["/product/add/"]
            C -->|"–ù–µ—Ç"| E["–ö–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç–∞"]
            
            D -->|"3. GET"| F["add_product view"]
            F -->|"4. –§–æ—Ä–º–∞"| G["ProductForm"]
            G -->|"5. –†–µ–Ω–¥–µ—Ä"| H["add_product.html"]
            H -->|"6. POST"| F
            F -->|"7. –í–∞–ª–∏–¥–∞—Ü–∏—è"| I{"form.is_valid"}
            I -->|"–î–∞"| J["Product.save"]
            I -->|"–ù–µ—Ç"| H
            J -->|"8. –†–µ–¥–∏—Ä–µ–∫—Ç"| K["/product/id/"]
            
            L["–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"] -->|"9. –ü—Ä–æ—Å–º–æ—Ç—Ä"| M["product_detail.html"]
            M -->|"10. –ü—Ä–æ–≤–µ—Ä–∫–∞"| N{"user.is_authenticated"}
            N -->|"–î–∞"| O["–ö–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"]
            N -->|"–ù–µ—Ç"| P["–°–æ–æ–±—â–µ–Ω–∏–µ –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å"]
            O -->|"11. POST"| Q["/cart/add/id/"]
            Q -->|"12. login_required"| R["add_to_cart view"]
            R -->|"13. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ"| S["CartItem.save"]
            S -->|"14. –†–µ–¥–∏—Ä–µ–∫—Ç"| M
            
            style A fill:#3498db,stroke:#2980b9,color:#fff
            style F fill:#2ecc71,stroke:#27ae60,color:#fff
            style R fill:#2ecc71,stroke:#27ae60,color:#fff
            style J fill:#e67e22,stroke:#d35400,color:#fff
            style S fill:#e67e22,stroke:#d35400,color:#fff
            style C fill:#f39c12,stroke:#e67e22,color:#fff
            style N fill:#f39c12,stroke:#e67e22,color:#fff
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è: –æ—Ç –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 6: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div class="diagram-container">
        <h2>6. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞</h2>
        <div class="mermaid">
        graph TB
            A[shop/] --> B[forms.py<br/>ProductForm]
            A --> C[views.py<br/>add_product<br/>add_to_cart]
            A --> D[urls.py<br/>product/add/<br/>cart/add/id/]
            A --> E[models.py<br/>Product<br/>Cart<br/>CartItem]
            
            F[templates/shop/] --> G[add_product.html<br/>—Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è]
            F --> H[product_list.html<br/>–∫–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä]
            F --> I[product_detail.html<br/>–∫–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É]
            
            J[myshop/] --> K[settings.py<br/>AUTH_USER_MODEL]
            
            B --> C
            C --> D
            C --> E
            C --> G
            C --> H
            C --> I
            K --> C
            
            style A fill:#3498db,stroke:#2980b9,color:#fff
            style F fill:#9b59b6,stroke:#8e44ad,color:#fff
            style B fill:#2ecc71,stroke:#27ae60,color:#fff
            style C fill:#2ecc71,stroke:#27ae60,color:#fff
            style E fill:#e67e22,stroke:#d35400,color:#fff
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞: —Ñ–æ—Ä–º—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –º–∞—Ä—à—Ä—É—Ç—ã, —à–∞–±–ª–æ–Ω—ã –∏ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="diagram-container">
        <h2>7. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
        <div class="mermaid">
        graph TB
            A["HTTP Request"] --> B{"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"}
            
            B -->|"–í View"| C["login_required<br/>–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä"]
            C -->|"–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"| D["–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ view"]
            C -->|"–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"| E["–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login/<br/>?next=—Ç–µ–∫—É—â–∏–π_URL"]
            
            B -->|"–í —à–∞–±–ª–æ–Ω–µ"| F["if user.is_authenticated<br/>—à–∞–±–ª–æ–Ω–Ω—ã–π —Ç–µ–≥"]
            F -->|"–î–∞"| G["–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏<br/>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä<br/>–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"]
            F -->|"–ù–µ—Ç"| H["–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è<br/>–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å"]
            
            D --> I["–î–æ—Å—Ç—É–ø –∫ request.user"]
            I --> J["–°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ<br/>Cart –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"]
            
            E --> K["–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞"]
            K -->|"–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞"| L["–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ next URL"]
            
            style C fill:#2ecc71,stroke:#27ae60,color:#fff
            style F fill:#9b59b6,stroke:#8e44ad,color:#fff
            style D fill:#27ae60,stroke:#229954,color:#fff
            style E fill:#e74c3c,stroke:#c0392b,color:#fff
            style G fill:#3498db,stroke:#2980b9,color:#fff
            style H fill:#e74c3c,stroke:#c0392b,color:#fff
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –î–≤–∞ —É—Ä–æ–≤–Ω—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —à–∞–±–ª–æ–Ω–æ–≤ —á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã.</p>
    </div>

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ 8: –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã ProductForm -->
    <div class="diagram-container">
        <h2>8. –ü–æ–ª—è —Ñ–æ—Ä–º—ã ProductForm –∏ –∏—Ö –≤–∞–ª–∏–¥–∞—Ü–∏—è</h2>
        <div class="mermaid">
        graph TB
            A[ProductForm] --> B[–ü–æ–ª—è —Ñ–æ—Ä–º—ã]
            
            B --> C[name<br/>CharField<br/>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞]
            B --> D[description<br/>TextField<br/>–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞]
            B --> E[price<br/>DecimalField<br/>–¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞]
            B --> F[image<br/>ImageField<br/>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞]
            B --> G[category<br/>ForeignKey<br/>–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞]
            B --> H[stock<br/>IntegerField<br/>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ]
            
            C --> I[–í–∞–ª–∏–¥–∞—Ü–∏—è:<br/>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ]
            D --> I
            E --> J[–í–∞–ª–∏–¥–∞—Ü–∏—è:<br/>MinValueValidator 0.01]
            H --> K[–í–∞–ª–∏–¥–∞—Ü–∏—è:<br/>MinValueValidator 0]
            F --> L[–í–∞–ª–∏–¥–∞—Ü–∏—è:<br/>–§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è]
            G --> M[–í–∞–ª–∏–¥–∞—Ü–∏—è:<br/>–°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏]
            
            I --> N{–í—Å–µ –ø–æ–ª—è –≤–∞–ª–∏–¥–Ω—ã?}
            J --> N
            K --> N
            L --> N
            M --> N
            
            N -->|–î–∞| O[form.is_valid = True<br/>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î]
            N -->|–ù–µ—Ç| P[form.is_valid = False<br/>–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫]
            
            style A fill:#3498db,stroke:#2980b9,color:#fff
            style O fill:#2ecc71,stroke:#27ae60,color:#fff
            style P fill:#e74c3c,stroke:#c0392b,color:#fff
        </div>
        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–æ—Ä–º—ã ProductForm: –ø–æ–ª—è, –∏—Ö —Ç–∏–ø—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.</p>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>
