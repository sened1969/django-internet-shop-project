# –ò—Ç–æ–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º "–¢–µ–º–∞ #20. –ó–∞–ø—Ä–æ—Å—ã –≤ Django ORM"

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `books/create_test_data.py`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
- 5 –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤ (–†–æ—Å—Å–∏—è, –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è, –°–®–ê)
- 6 –º–∞–≥–∞–∑–∏–Ω–æ–≤ (–ú–æ—Å–∫–≤–∞, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥)
- 10 –∫–Ω–∏–≥ (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞)
- ~25 –æ—Ç–∑—ã–≤–æ–≤ (–ø–æ 2-3 –Ω–∞ –∫–∞–∂–¥—É—é –∫–Ω–∏–≥—É)

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `books/–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–°–û–ó–î–ê–ù–ò–Ø_–¢–ï–°–¢–û–í–´–•_–î–ê–ù–ù–´–•.md`

### 2. ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞:** `–ü—Ä–æ—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è/`

**–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã —Ñ–∞–π–ª—ã:**
- –ê–ù–ê–õ–ò–ó_–ò–ù–¢–ï–ì–†–ê–¶–ò–ò_–¢–ï–ú–ê_19.md
- –ê–ù–ê–õ–ò–ó_–ò–ù–¢–ï–ì–†–ê–¶–ò–ò_–¢–ï–ú–ê_20.md
- –ê–ù–ê–õ–ò–ó_–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø_–î–ó.md
- –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø_–î–ó.md
- –ò–ù–°–¢–†–£–ö–¶–ò–Ø_–ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–ï_–ü–†–û–ï–ö–¢–ê.md
- –ò–ù–°–¢–†–£–ö–¶–ò–Ø.md
- –ò–¢–û–ì–û–í–´–ô_–û–¢–ß–ï–¢_–ì–û–¢–û–í–ù–û–°–¢–ò.md
- –û–¢–ß–ï–¢_–ì–û–¢–û–í–ù–û–°–¢–ò_–¢–ï–ú–ê_19.md
- –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–ü–û_–°–ö–†–ò–ù–®–û–¢–ê–ú.md
- –†–ï–®–ï–ù–ò–ï_–î–ó.md

### 3. ‚úÖ –°–æ—Å—Ç–∞–≤–ª–µ–Ω –ø–µ—Ä–µ—á–µ–Ω—å —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

**–§–∞–π–ª:** `–°–ö–†–ò–ù–®–û–¢–´_–î–õ–Ø_–°–î–ê–ß–ò_–¢–ï–ú–ê_20.md`

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- 10 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- URL-–∞–¥—Ä–µ—Å–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
- –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd "C:\Users\sened\Desktop\–û–±—É—á–µ–Ω–∏–µ_GPT_PD\lesson_17_Templates. –†–∞–±–æ—Ç–∞ —Å —à–∞–±–ª–æ–Ω–∞–º–∏"
python manage.py runserver
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –û—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:8000/admin/ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª:
```bash
python manage.py shell
>>> exec(open('books/create_test_data.py').read())
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:8000/admin/
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
3. –°–æ–∑–¥–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞: http://127.0.0.1:8000/admin/books/publisher/
- –ú–∞–≥–∞–∑–∏–Ω—ã: http://127.0.0.1:8000/admin/books/store/
- –ö–Ω–∏–≥–∏: http://127.0.0.1:8000/admin/books/book/
- –û—Ç–∑—ã–≤—ã: http://127.0.0.1:8000/admin/books/review/

---

## üì∏ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã (10 —à—Ç—É–∫)

1. **–ì–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**
   - URL: http://127.0.0.1:8000/admin/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –†–∞–∑–¥–µ–ª BOOKS —Å –º–æ–¥–µ–ª—è–º–∏

2. **–°–ø–∏—Å–æ–∫ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤**
   - URL: http://127.0.0.1:8000/admin/books/publisher/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –°–ø–∏—Å–æ–∫ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏

3. **–§–æ—Ä–º–∞ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞**
   - URL: http://127.0.0.1:8000/admin/books/publisher/add/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –§–æ—Ä–º—É —Å –ø–æ–ª—è–º–∏

4. **–°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤**
   - URL: http://127.0.0.1:8000/admin/books/store/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –°–ø–∏—Å–æ–∫ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏

5. **–§–æ—Ä–º–∞ –º–∞–≥–∞–∑–∏–Ω–∞**
   - URL: http://127.0.0.1:8000/admin/books/store/add/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –§–æ—Ä–º—É —Å –ø–æ–ª—è–º–∏

6. **–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥**
   - URL: http://127.0.0.1:8000/admin/books/book/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –°–ø–∏—Å–æ–∫ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ (–∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –æ—Ç–∑—ã–≤—ã, –æ—Ü–µ–Ω–∫–∞)

7. **–§–æ—Ä–º–∞ –∫–Ω–∏–≥–∏ —Å —Å–≤—è–∑—è–º–∏**
   - URL: http://127.0.0.1:8000/admin/books/book/add/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –§–æ—Ä–º—É —Å ForeignKey –∏ ManyToManyField

8. **–ö–Ω–∏–≥–∞ —Å –∏–Ω–ª–∞–π–Ω-–æ—Ç–∑—ã–≤–∞–º–∏**
   - URL: http://127.0.0.1:8000/admin/books/book/[id]/change/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –ò–Ω–ª–∞–π–Ω-—Ä–µ–¥–∞–∫—Ç–æ—Ä –æ—Ç–∑—ã–≤–æ–≤

9. **–°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤**
   - URL: http://127.0.0.1:8000/admin/books/review/
   - –ü–æ–∫–∞–∑–∞—Ç—å: –°–ø–∏—Å–æ–∫ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏

10. **–§–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞**
    - URL: http://127.0.0.1:8000/admin/books/review/add/
    - –ü–æ–∫–∞–∑–∞—Ç—å: –§–æ—Ä–º—É —Å ForeignKey –Ω–∞ –∫–Ω–∏–≥—É

**–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫:** –°–º. `–°–ö–†–ò–ù–®–û–¢–´_–î–õ–Ø_–°–î–ê–ß–ò_–¢–ï–ú–ê_20.md`

---

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞:
- `–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø_–¢–ï–ú–ê_20.md` - –û–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- `–°–ö–†–ò–ù–®–û–¢–´_–î–õ–Ø_–°–î–ê–ß–ò_–¢–ï–ú–ê_20.md` - –ü–µ—Ä–µ—á–µ–Ω—å —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- `books/README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `books/–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–°–û–ó–î–ê–ù–ò–Ø_–¢–ï–°–¢–û–í–´–•_–î–ê–ù–ù–´–•.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –í –ø–∞–ø–∫–µ "–ü—Ä–æ—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è":
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ—à–ª—ã–º —Ç–µ–º–∞–º
- –û—Ç—á—ë—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í –ø–∞–ø–∫–µ "books":
- `create_test_data.py` - –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `queries.py` - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –∑–∞–¥–∞–Ω–∏–π
- `models.py` - –ú–æ–¥–µ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `admin.py` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã:

```python
python manage.py shell
>>> from books.queries import *

# –ó–∞–ø—Ä–æ—Å 1: –ö–Ω–∏–≥–∏ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤ –∏–∑ –†–æ—Å—Å–∏–∏
print_books_by_publisher_country('–†–æ—Å—Å–∏—è')

# –ó–∞–ø—Ä–æ—Å 2: –ö–Ω–∏–≥–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö –ú–æ—Å–∫–≤—ã
print_books_by_store_city('–ú–æ—Å–∫–≤–∞')

# –ó–∞–ø—Ä–æ—Å 3: –ö–Ω–∏–≥–∏ —Å–æ —Å—Ä–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–∫–æ–π –≤—ã—à–µ 4.5
print_books_with_avg_rating_above(4.5)

# –ó–∞–ø—Ä–æ—Å 4: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥ –≤ –∫–∞–∂–¥–æ–º –º–∞–≥–∞–∑–∏–Ω–µ
print_store_books_count()

# –ó–∞–ø—Ä–æ—Å 5: –ú–∞–≥–∞–∑–∏–Ω—ã —Å –∫–Ω–∏–≥–∞–º–∏ –ø–æ—Å–ª–µ 2010 –≥–æ–¥–∞
from datetime import date
print_stores_with_books_after_date(date(2010, 1, 1))

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
demonstrate_optimization()
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ –º–æ–¥–µ–ª–∏ –≤–∏–¥–Ω—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- [ ] –°–≤—è–∑–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –°–∫—Ä–∏–Ω—à–æ—Ç—ã:
- [ ] –í—Å–µ 10 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
- [ ] URL –≤–∏–¥–Ω—ã –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
- [ ] –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤–∏–¥–Ω—ã
- [ ] –°–∫—Ä–∏–Ω—à–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [ ] –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≥–æ—Ç–æ–≤
- [ ] –ó–∞–ø—Ä–æ—Å—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞

---

## üìû –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:
- –ì–ª–∞–≤–Ω–∞—è: http://127.0.0.1:8000/admin/
- –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞: http://127.0.0.1:8000/admin/books/publisher/
- –ú–∞–≥–∞–∑–∏–Ω—ã: http://127.0.0.1:8000/admin/books/store/
- –ö–Ω–∏–≥–∏: http://127.0.0.1:8000/admin/books/book/
- –û—Ç–∑—ã–≤—ã: http://127.0.0.1:8000/admin/books/review/

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `books/README.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `books/–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–°–û–ó–î–ê–ù–ò–Ø_–¢–ï–°–¢–û–í–´–•_–î–ê–ù–ù–´–•.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–∞–Ω–Ω—ã–º
- `–°–ö–†–ò–ù–®–û–¢–´_–î–õ–Ø_–°–î–ê–ß–ò_–¢–ï–ú–ê_20.md` - –°–ø–∏—Å–æ–∫ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- `–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø_–¢–ï–ú–ê_20.md` - –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27  
**–í–µ—Ä—Å–∏—è:** 1.0

